 

参看链接：<https://blog.csdn.net/eson_15/article/details/51725470>

# 1 数据检验**

## **1.1 JSR 303**

​	**JSR 303** 是 Java 为 Bean 数据合法性校验提供的标准框架，它已经包含在 JavaEE 6.0 中 .

​	JSR 303 通过在 **Bean** 属性上标注类似于 @NotNull、@Max等标准的注解指定校验规则，并通过标准的验证接口对 Bean 进行验证

![JSR 303](./assets/JSR 303.jpg) 

## **1.2 Hibernate Validator **

### 1.2.1 概述

​	Hibernate Validator是Hibernate提供的一个开源框架，使用注解方式非常方便的实现服务端的数据校验。

官网：<http://hibernate.org/validator/>

**hibernate Validator** 是 Bean Validation 的参考实现 。

Hibernate Validator 提供了 JSR 303 规范中所有内置 constraint（约束） 的实现，除此之外还有一些附加的 constraint。

在日常开发中，Hibernate Validator经常用来验证bean的字段，基于注解，方便快捷高效。



### 1.2.2 Bean校验的注解

常用注解如下：

| **Constraint**                                   | **详细信息**                                                 |
| ------------------------------------------------ | ------------------------------------------------------------ |
| **@Valid**                                       | 被注释的元素是一个对象，需要检查此对象的所有字段值           |
| **@Null**                                        | 被注释的元素必须为 null                                      |
| **@NotNull**                                     | 被注释的元素必须不为 null                                    |
| **@AssertTrue**                                  | 被注释的元素必须为 true                                      |
| **@AssertFalse**                                 | 被注释的元素必须为 false                                     |
| **@Min(value)**                                  | 被注释的元素必须是一个数字，其值必须大于等于指定的最小值     |
| **@Max(value)**                                  | 被注释的元素必须是一个数字，其值必须小于等于指定的最大值     |
| **@DecimalMin(value)**                           | 被注释的元素必须是一个数字，其值必须大于等于指定的最小值     |
| **@DecimalMax(value)**                           | 被注释的元素必须是一个数字，其值必须小于等于指定的最大值     |
| **@Size(max, min)**                              | 被注释的元素的大小必须在指定的范围内                         |
| **@Digits (integer, fraction)**                  | 被注释的元素必须是一个数字，其值必须在可接受的范围内         |
| **@Past**                                        | 被注释的元素必须是一个过去的日期                             |
| **@Future**                                      | 被注释的元素必须是一个将来的日期                             |
| **@Pattern(value)**                              | 被注释的元素必须符合指定的正则表达式                         |
| **@Email**                                       | 被注释的元素必须是电子邮箱地址                               |
| **@Length**                                      | 被注释的字符串的大小必须在指定的范围内                       |
| **@NotEmpty**                                    | 被注释的字符串的必须非空                                     |
| **@Range**                                       | 被注释的元素必须在合适的范围内                               |
| **@NotBlank**                                    | 被注释的字符串的必须非空                                     |
| **@URL(protocol=,host=, port=,regexp=, flags=)** | 被注释的字符串必须是一个有效的url                            |
| **@CreditCardNumber**                            | 被注释的字符串必须通过Luhn校验算法，银行卡，信用卡等号码一般都用Luhn计算合法性 |

### 1.2.3 使用

#### **1.2.3.1 给po,vo添加校验**

​	对象的部分属性上添加注解：

![注解](./assets/注解.png)

 

#### 1.2.3.2 在controller上@Valid

在controller中改造register方法，只需要给User添加 @Valid注解即可。

![Valid](./assets/Valid.png)



#### **1.2.3.3 测试**

我们故意填错：

![测试](./assets/测试.png) 

### 1.2.4 **捕获校验错误信息**

​	在需要校验的pojo前边添加@Validated，在需要校验的pojo后边添加BindingResult bindingResult来接收校验出错信息。值得注意的是：@Validated和BindingResult bindingResult是配对出现，并且形参顺序是固定的（一前一后）。这样就可以顺利接收到错误信息了。

![验证出差结果](./assets/验证出差结果.jpg)

![捕获校验错误信息](./assets/捕获校验错误信息.png)

### **1.2.5 分组校验**@Validated

​	一个controller不需要去校验生产日期，只要校验一下商品名称即可，另一个controller两个都要校验，这样就没法做了，因为两个controller都使用同一个pojo。
　　为了解决这个问题，我们可以定义多个校验分组（其实是一个java接口），分组中定义有哪些规则，每个controller方法使用不同的校验分组即可

![分组校验](./assets/分组校验.png)

```
分别POST请求：(数据接口上有)
http://localhost:8080/api/openapi/apiQuick/testSqlQuery
http://localhost:8080/api/openapi/apiQuick/saveSqlQuery （"msg": "apiCode 不为空, 必填",）

{"authType":"授权","requestUrl":"testApiFast","remark":"testApiFast","reqs":[{"tabId":"a9711c3ce6809a5809e50fbc34f6fc5c","colName":"user_name","colCon":"=","colDefaultVal":"sys"}],"tabId":"a9711c3ce6809a5809e50fbc34f6fc5c", "tabName": "fw_user", "dbuserId": "1"}
```





 

 

 

 

 

 

 

 

 